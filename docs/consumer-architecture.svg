<?xml version="1.0" encoding="UTF-8"?>
<svg viewBox="0 0 920 720" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <style type="text/css">
            @import url('https://fonts.googleapis.com/css2?family=Red+Hat+Text:wght@400;500;600;700&amp;family=Red+Hat+Display:wght@400;700&amp;display=swap');
        </style>
        <marker id="arrowhead" markerWidth="6" markerHeight="5" refX="5" refY="2.5" orient="auto">
            <polygon points="0 0, 6 2.5, 0 5" fill="#90a4ae"/>
        </marker>
        <filter id="shadow" x="-10%" y="-10%" width="120%" height="120%">
            <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.3"/>
        </filter>
    </defs>

    <!-- Title with Badge -->
    <text x="460" y="30" text-anchor="middle" fill="#1565c0" font-weight="700" font-size="22" font-family="'Red Hat Display', sans-serif">SWIM DNOTAM Consumer</text>
    <rect x="680" y="15" width="180" height="24" rx="12" fill="#ffc107"/>
    <text x="770" y="32" text-anchor="middle" fill="#000" font-weight="600" font-size="11" font-family="'Red Hat Text', sans-serif">SWIM-TI Yellow Profile</text>
    <text x="460" y="52" text-anchor="middle" fill="#64b5f6" font-size="14" font-family="'Red Hat Text', sans-serif">Event Processing &amp; Distribution</text>

    <!-- ==================== INTERNAL ENVIRONMENT BOX (Left Side) ==================== -->
    <rect x="20" y="80" width="580" height="620" rx="12" fill="none" stroke="#1565c0" stroke-width="2"/>
    <rect x="20" y="80" width="580" height="34" rx="12" fill="#1565c0"/>
    <rect x="20" y="107" width="580" height="7" fill="#1565c0"/>
    <text x="310" y="105" text-anchor="middle" fill="#ffffff" font-weight="700" font-size="15" font-family="'Red Hat Display', sans-serif">Internal Environment â€” ANSP</text>

    <!-- ==================== OBSERVABILITY (Top Left inside Internal) ==================== -->
    <rect x="40" y="130" width="180" height="120" rx="8" fill="#1a237e" stroke="#3949ab" stroke-width="2" filter="url(#shadow)"/>
    <rect x="40" y="130" width="180" height="30" rx="8" fill="#3949ab"/>
    <rect x="40" y="152" width="180" height="8" fill="#3949ab"/>
    <text x="130" y="152" text-anchor="middle" fill="#fff" font-weight="600" font-size="14" font-family="'Red Hat Text', sans-serif">Observability</text>
    
    <text x="80" y="185" text-anchor="middle" fill="#ff9800" font-weight="600" font-size="12" font-family="'Red Hat Text', sans-serif">Prometheus</text>
    <text x="175" y="185" text-anchor="middle" fill="#f06292" font-weight="600" font-size="12" font-family="'Red Hat Text', sans-serif">Grafana</text>
    
    <text x="80" y="215" text-anchor="middle" fill="#4dd0e1" font-weight="600" font-size="12" font-family="'Red Hat Text', sans-serif">Tempo</text>
    <text x="175" y="215" text-anchor="middle" fill="#81c784" font-weight="600" font-size="12" font-family="'Red Hat Text', sans-serif">OpenTelemetry</text>
    
    <text x="130" y="240" text-anchor="middle" fill="#9fa8da" font-size="11" font-family="'Red Hat Text', sans-serif">Metrics | Tracing | Dashboards</text>

    <!-- ==================== MONGODB (Left inside Internal) ==================== -->
    <rect x="40" y="280" width="180" height="180" rx="8" fill="#424242" stroke="#757575" stroke-width="2" filter="url(#shadow)"/>
    <rect x="40" y="280" width="180" height="30" rx="8" fill="#757575"/>
    <rect x="40" y="302" width="180" height="8" fill="#757575"/>
    <text x="130" y="302" text-anchor="middle" fill="#fff" font-weight="600" font-size="14" font-family="'Red Hat Text', sans-serif">MongoDB</text>
    <text x="130" y="345" text-anchor="middle" fill="#e0e0e0" font-size="13" font-family="'Red Hat Text', sans-serif">subscriptions</text>
    <text x="130" y="375" text-anchor="middle" fill="#e0e0e0" font-size="13" font-family="'Red Hat Text', sans-serif">inbox_messages</text>
    <text x="130" y="405" text-anchor="middle" fill="#e0e0e0" font-size="13" font-family="'Red Hat Text', sans-serif">dnotam_events</text>
    <text x="130" y="435" text-anchor="middle" fill="#e0e0e0" font-size="13" font-family="'Red Hat Text', sans-serif">dead_letter_queue</text>

    <!-- ==================== KAFKA TOPICS (Left inside Internal) ==================== -->
    <rect x="40" y="490" width="180" height="190" rx="8" fill="#424242" stroke="#757575" stroke-width="2" filter="url(#shadow)"/>
    <rect x="40" y="490" width="180" height="30" rx="8" fill="#757575"/>
    <rect x="40" y="512" width="180" height="8" fill="#757575"/>
    <text x="130" y="512" text-anchor="middle" fill="#fff" font-weight="700" font-size="14" font-family="'Red Hat Display', sans-serif">Kafka Topics</text>
    <text x="130" y="555" text-anchor="middle" fill="#4caf50" font-size="13" font-family="'Red Hat Text', sans-serif">closure-topic</text>
    <text x="130" y="582" text-anchor="middle" fill="#2196f3" font-size="13" font-family="'Red Hat Text', sans-serif">restriction-topic</text>
    <text x="130" y="609" text-anchor="middle" fill="#ff9800" font-size="13" font-family="'Red Hat Text', sans-serif">surface-condition-topic</text>
    <text x="130" y="636" text-anchor="middle" fill="#9c27b0" font-size="13" font-family="'Red Hat Text', sans-serif">airspace-topic</text>
    <text x="130" y="668" text-anchor="middle" fill="#bdbdbd" font-style="italic" font-size="11" font-family="'Red Hat Text', sans-serif">Routed by Business Intent</text>

    <!-- ==================== CONSUMER BOX (Right inside Internal Environment) ==================== -->
    <rect x="300" y="130" width="280" height="550" rx="12" fill="none" stroke="#42a5f5" stroke-width="2"/>
    <rect x="300" y="130" width="280" height="34" rx="12" fill="#42a5f5"/>
    <rect x="300" y="157" width="280" height="7" fill="#42a5f5"/>
    <text x="440" y="155" text-anchor="middle" fill="#ffffff" font-weight="700" font-size="16" font-family="'Red Hat Display', sans-serif">DNOTAM Consumer</text>

    <!-- Quarkus + Cloud-Native badges -->
    <rect x="320" y="175" width="75" height="20" rx="10" fill="#4695eb"/>
    <text x="357" y="190" text-anchor="middle" fill="#fff" font-weight="600" font-size="10" font-family="'Red Hat Text', sans-serif">Quarkus</text>
    <rect x="405" y="175" width="90" height="20" rx="10" fill="#0db7ed"/>
    <text x="450" y="190" text-anchor="middle" fill="#fff" font-weight="600" font-size="10" font-family="'Red Hat Text', sans-serif">Cloud-Native</text>

    <!-- Subscription Service -->
    <rect x="320" y="210" width="240" height="70" rx="6" fill="#e3f2fd" stroke="#1976d2" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="440" y="240" text-anchor="middle" fill="#0d47a1" font-weight="600" font-size="14" font-family="'Red Hat Text', sans-serif">Subscription Management</text>
    <text x="440" y="265" text-anchor="middle" fill="#1565c0" font-size="12" font-family="'Red Hat Text', sans-serif">Reconciliation Service</text>

    <!-- AMQP Consumer -->
    <rect x="320" y="310" width="240" height="70" rx="6" fill="#e3f2fd" stroke="#1976d2" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="440" y="340" text-anchor="middle" fill="#0d47a1" font-weight="600" font-size="14" font-family="'Red Hat Text', sans-serif">AMQP Consumer</text>
    <text x="440" y="365" text-anchor="middle" fill="#1565c0" font-size="12" font-family="'Red Hat Text', sans-serif">Vert.x Client</text>

    <!-- Event Processor -->
    <rect x="320" y="410" width="240" height="95" rx="6" fill="#e3f2fd" stroke="#1976d2" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="440" y="440" text-anchor="middle" fill="#0d47a1" font-weight="600" font-size="14" font-family="'Red Hat Text', sans-serif">Event Processor</text>
    <text x="440" y="465" text-anchor="middle" fill="#1565c0" font-size="12" font-family="'Red Hat Text', sans-serif">XSD Validation + Schematron</text>
    <text x="440" y="490" text-anchor="middle" fill="#ff8f00" font-size="11" font-family="'Red Hat Text', sans-serif">Inbox Pattern + GraphQL API</text>

    <!-- Fault Tolerance -->
    <rect x="320" y="535" width="240" height="60" rx="6" fill="#e3f2fd" stroke="#1976d2" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="440" y="565" text-anchor="middle" fill="#0d47a1" font-weight="600" font-size="14" font-family="'Red Hat Text', sans-serif">Fault Tolerance</text>
    <text x="440" y="585" text-anchor="middle" fill="#1565c0" font-size="12" font-family="'Red Hat Text', sans-serif">Retry / CircuitBreaker / Bulkhead</text>

    <!-- Kafka Producer -->
    <rect x="320" y="625" width="240" height="45" rx="6" fill="#e3f2fd" stroke="#1976d2" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="440" y="655" text-anchor="middle" fill="#0d47a1" font-weight="600" font-size="14" font-family="'Red Hat Text', sans-serif">Kafka Producer (Outbox)</text>

    <!-- ==================== EXTERNAL SERVICES (Right - Outside Internal Environment) ==================== -->
    
    <!-- External: Subscription Manager API -->
    <rect x="720" y="200" width="160" height="100" rx="8" fill="#fff3e0" stroke="#f57c00" stroke-width="2" filter="url(#shadow)"/>
    <rect x="720" y="200" width="160" height="30" rx="8" fill="#f57c00"/>
    <rect x="720" y="222" width="160" height="8" fill="#f57c00"/>
    <text x="800" y="222" text-anchor="middle" fill="#fff" font-weight="600" font-size="14" font-family="'Red Hat Text', sans-serif">Subscription API</text>
    <text x="800" y="255" text-anchor="middle" fill="#e65100" font-size="13" font-family="'Red Hat Text', sans-serif">REST (mTLS)</text>
    <text x="800" y="280" text-anchor="middle" fill="#ff9800" font-size="12" font-family="'Red Hat Text', sans-serif">External Provider</text>

    <!-- External: AMQP Broker -->
    <rect x="720" y="345" width="160" height="100" rx="8" fill="#fff3e0" stroke="#f57c00" stroke-width="2" filter="url(#shadow)"/>
    <rect x="720" y="345" width="160" height="30" rx="8" fill="#f57c00"/>
    <rect x="720" y="367" width="160" height="8" fill="#f57c00"/>
    <text x="800" y="367" text-anchor="middle" fill="#fff" font-weight="600" font-size="14" font-family="'Red Hat Text', sans-serif">AMQP Broker</text>
    <text x="800" y="400" text-anchor="middle" fill="#e65100" font-size="13" font-family="'Red Hat Text', sans-serif">AMQP 1.0 (mTLS)</text>
    <text x="800" y="425" text-anchor="middle" fill="#ff9800" font-size="12" font-family="'Red Hat Text', sans-serif">External Provider</text>

    <!-- ==================== ARROWS ==================== -->

    <!-- Consumer to Observability (horizontal straight) -->
    <line x1="300" y1="190" x2="225" y2="190" stroke="#3949ab" stroke-width="2" stroke-dasharray="4,2" marker-end="url(#arrowhead)"/>

    <!-- Event Processor to MongoDB (horizontal straight) -->
    <line x1="315" y1="370" x2="225" y2="370" stroke="#90a4ae" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Kafka Producer to Kafka Topics (horizontal straight) -->
    <line x1="315" y1="585" x2="225" y2="585" stroke="#90a4ae" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Consumer to Subscription API (horizontal straight) -->
    <line x1="565" y1="245" x2="715" y2="245" stroke="#90a4ae" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Consumer to AMQP Broker (horizontal straight) -->
    <line x1="565" y1="395" x2="715" y2="395" stroke="#90a4ae" stroke-width="2" marker-end="url(#arrowhead)"/>

    <!-- Internal vertical flow with proper spacing -->
    <line x1="440" y1="285" x2="440" y2="305" stroke="#90a4ae" stroke-width="2" marker-end="url(#arrowhead)"/>
    <line x1="440" y1="385" x2="440" y2="405" stroke="#90a4ae" stroke-width="2" marker-end="url(#arrowhead)"/>
    <line x1="440" y1="510" x2="440" y2="530" stroke="#90a4ae" stroke-width="2" marker-end="url(#arrowhead)"/>
    <line x1="440" y1="600" x2="440" y2="620" stroke="#90a4ae" stroke-width="2" marker-end="url(#arrowhead)"/>

</svg>
